<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping default-lazy="false" default-cascade="all-delete-orphan">
    
    <class name="edu.wisc.my.portlets.bookmarks.domain.Entry" table="BOOKMARK_STORE">
        <id name="id" type="long" unsaved-value="-1">
            <column name="ENTRY_ID" not-null="true"/>
            <generator class="native"/>
        </id>
        
        <discriminator type="string">
            <column name="ENTRY_TYPE" length="64"/>
        </discriminator>

        <property name="name" type="string">
            <column name="NAME" length="4000" index="NameIdx"/>
        </property>
        <property name="note" type="string">
            <column name="NOTE" length="4000"/>
        </property>
        <property name="created" type="java.util.Date">
            <column name="CREATED" not-null="true"/>
        </property>
        <property name="modified" type="java.util.Date">
            <column name="MODIFIED" not-null="true"/>
        </property>


        <subclass name="edu.wisc.my.portlets.bookmarks.domain.Folder" discriminator-value="FOLDER">
            <map name="children" fetch="join" optimistic-lock="false">
                <key>
                    <column name="PARENT_FOLDER_ID" not-null="false"/>
                </key>
                <map-key type="long">
                    <formula>ENTRY_ID</formula>
                </map-key>
                <one-to-many class="edu.wisc.my.portlets.bookmarks.domain.Entry" not-found="ignore"/>
            </map>
            
            <!-- TODO figure out how to persist comparator -->
            <property name="minimized" type="true_false">
                <column name="MINIMIZED"/>
            </property>
            
            <subclass name="edu.wisc.my.portlets.bookmarks.domain.BookmarkSet" discriminator-value="BOOKMARK_SET">
                <property name="owner" type="string">
                    <column name="OWNER" length="500" index="NameIdx"/>
                </property>
            </subclass>
        </subclass>
        
        
        <subclass name="edu.wisc.my.portlets.bookmarks.domain.Bookmark" discriminator-value="BOOKMARK">
            <property name="url" type="string">
                <column name="URL" length="4000"/>
            </property>
            <property name="newWindow" type="true_false">
                <column name="NEW_WINDOW"/>
            </property>
        </subclass>
    </class>
</hibernate-mapping>