<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>
<!--
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:util="http://www.springframework.org/schema/util"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd">
-->    

    
    <bean id="bookmarkValidator" class="edu.wisc.my.portlets.bookmarks.domain.validation.BookmarkValidator"/>
    
    <bean id="baseBookmarksController" abstract="true">
        <property name="bookmarkStore"><ref bean="bookmarkStore"/></property>
        <property name="bookmarkSetRequestResolver"><ref bean="bookmarkSetRequestResolver"/></property>
    </bean>
    
    <bean id="baseBookmarksFormController" abstract="true" parent="baseBookmarksController">
        <property name="sessionForm" value="false"/>
        <property name="commandClass" value="edu.wisc.my.portlets.bookmarks.domain.Bookmark"/>
        
        <property name="formView" value="viewBookmarks"/>
        <property name="successView" value="viewBookmarks"/>
    </bean>
    
    <bean id="viewBookmarksFormController" class="edu.wisc.my.portlets.bookmarks.web.ViewBookmarksController" parent="baseBookmarksFormController">
    </bean>

    <bean id="newBookmarkFormController" class="edu.wisc.my.portlets.bookmarks.web.NewBookmarkFormController" parent="baseBookmarksFormController">
        <property name="validator"><ref bean="bookmarkValidator"/></property> 
    </bean>
    
    <bean id="editBookmarkFormController" class="edu.wisc.my.portlets.bookmarks.web.EditBookmarkFormController" parent="baseBookmarksFormController">
        <property name="validator"><ref bean="bookmarkValidator"/></property> 
    </bean>
    
    <bean id="newFolderFormController" class="edu.wisc.my.portlets.bookmarks.web.NewFolderFormController" parent="baseBookmarksFormController">
        <property name="commandClass" value="edu.wisc.my.portlets.bookmarks.domain.Folder"/>
    </bean>
    
    <bean id="editFolderFormController" class="edu.wisc.my.portlets.bookmarks.web.EditFolderFormController" parent="baseBookmarksFormController">
        <property name="commandClass" value="edu.wisc.my.portlets.bookmarks.domain.Folder"/>
    </bean>
    
    <bean id="toggleFolderFormController" class="edu.wisc.my.portlets.bookmarks.web.ToggleFolderFormController" parent="baseBookmarksController">
    </bean>
    
    <bean id="deleteEntryFormController" class="edu.wisc.my.portlets.bookmarks.web.DeleteEntryFormController" parent="baseBookmarksController">
    </bean>
    
    
    <bean id="portletOpenSessionInViewInterceptor" class="org.springframework.orm.hibernate3.support.PortletOpenSessionInViewInterceptor">
        <property name="sessionFactory">
            <ref bean="sessionFactory" />
        </property>
    </bean>
    
    <bean id="parameterMappingInterceptor" class="org.springframework.web.portlet.handler.ParameterMappingInterceptor"/>
    
    <bean id="portletModeParameterHandlerMapping" class="org.springframework.web.portlet.handler.PortletModeParameterHandlerMapping">
        <property name="order" value="10"/>
        <property name="interceptors">
            <list>
                <ref bean="portletOpenSessionInViewInterceptor"/>
                <ref bean="parameterMappingInterceptor"/>
            </list>
        </property>
        <property name="portletModeParameterMap">
            <map>
                <entry key="view">
                    <map>
                        <entry key="viewBookmarks"><ref local="viewBookmarksFormController"/></entry>
                        <entry key="newBookmark"><ref bean="newBookmarkFormController"/></entry>
                        <entry key="editBookmark"><ref bean="editBookmarkFormController"/></entry>
                        <entry key="newFolder"><ref bean="newFolderFormController"/></entry>
                        <entry key="editFolder"><ref bean="editFolderFormController"/></entry>
                        <entry key="toggleFolder"><ref bean="toggleFolderFormController"/></entry>
                        <entry key="deleteEntry"><ref bean="deleteEntryFormController"/></entry>
                    </map>
                </entry>
            </map>
        </property>
    </bean>
    
    <bean id="portletModeHandlerMapping" class="org.springframework.web.portlet.handler.PortletModeHandlerMapping">
        <property name="order" value="20"/>
        <property name="interceptors">
            <list>
                <ref bean="portletOpenSessionInViewInterceptor"/>
            </list>
        </property>
        <property name="portletModeMap">
            <map>
                <entry key="view"><ref local="viewBookmarksFormController"/></entry>
            </map>
        </property>
    </bean>
    
</beans>